{"version":3,"sources":["webpack:///C:/Users/admin/Desktop/src/src/pages/rotateLottery/components/Lottery.vue?2501","webpack:///C:/Users/admin/Desktop/src/src/pages/rotateLottery/components/Lottery.vue?b60c","webpack:///C:/Users/admin/Desktop/src/src/pages/rotateLottery/components/Lottery.vue?3fa8","webpack:///C:/Users/admin/Desktop/src/src/pages/rotateLottery/components/Lottery.vue?cdbd","uni-app:///pages/rotateLottery/components/Lottery.vue","webpack:///C:/Users/admin/Desktop/src/src/pages/rotateLottery/components/Lottery.vue?ae2c","webpack:///C:/Users/admin/Desktop/src/src/pages/rotateLottery/components/Lottery.vue?02fe"],"names":[],"mappings":"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;AAaA,qBAbA,+BAaA;AACA;AACA,KAfA;AAgBA,oBAhBA,8BAgBA;AACA;AACA,KAlBA;AAmBA;AACA,eApBA,yBAoBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA,KAhCA;AAiCA,eAjCA,yBAiCA;AACA;AACA,KAnCA;AAoCA;AACA,iBArCA,2BAqCA;AACA;AACA,KAvCA;AAwCA;AACA,gBAzCA,0BAyCA;AACA;AACA,KA3CA;AA4CA;AACA,cA7CA,wBA6CA;AACA;AACA,KA/CA;AAgDA;AACA,gBAjDA,0BAiDA;AACA;AACA;AACA,KApDA,EArNA;;AA2QA;AACA;AACA,cAFA,sBAEA,MAFA,EAEA,MAFA,EAEA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA,KATA,EA3QA;;AAsRA;AACA,iBADA,2BACA;AACA;AACA,KAHA;AAIA;AACA,iBALA,2BAKA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAfA,MAeA;AACA;AACA;AACA;AACA;AACA;AACA,SALA,MAKA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OANA,EAMA,OANA;;AAQA;AACA;AACA;;AAEA;AACA;AACA,OANA,EAMA,YANA;AAOA,KA/DA;AAgEA;AACA,qBAjEA,+BAiEA;AACA;AACA;AACA;AACA,KArEA;AAsEA;AACA,kBAvEA,4BAuEA;AACA;AACA,wBAFA,GAEA,eAFA;AAGA,mBAHA,GAGA,yCAHA;;AAKA;AACA,uBANA,GAMA,qBANA;AAOA,uBAPA,GAOA,qBAPA;;AASA;AACA,0BAVA,GAUA,uBAVA;AAWA,yBAXA,GAWA,wBAXA;;AAaA;AACA;;AAEA;AACA;AACA,iBAlBA,GAkBA,CAlBA,cAkBA,cAlBA;AAmBA,yBAnBA,GAmBA,mBAnBA;AAoBA;AACA,qBArBA,GAqBA,a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","file":"pages/rotateLottery/components/Lottery.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./Lottery.vue?vue&type=template&id=d75a852c&scoped=true&\"\nvar renderjs\nimport script from \"./Lottery.vue?vue&type=script&lang=js&\"\nexport * from \"./Lottery.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Lottery.vue?vue&type=style&index=0&id=d75a852c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"d75a852c\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/rotateLottery/components/Lottery.vue\"\nexport default component.exports","export * from \"-!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./Lottery.vue?vue&type=template&id=d75a852c&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./Lottery.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./Lottery.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"almost-lottery\">\r\n    <view class=\"almost-lottery__wrap\" :style=\"{ width: lotterySize + 'rpx', height: lotterySize + 'rpx' }\">\n      <view class=\"lottery-action\" :style=\"{ width: actionSize + 'rpx', height: actionSize + 'rpx', left: canvasMarginOutside + 'rpx' }\"></view>\n      <view class=\"str-margin-outside\" :style=\"{ left: strMarginOutside + 'rpx' }\"></view>\n      <view class=\"img-margin-str\" :style=\"{ left: imgMarginStr + 'rpx' }\"></view>\n      <view class=\"img-size\" :style=\"{ width: imgWidth + 'rpx', height: imgHeight + 'rpx' }\"></view>\r\n      <template v-if=\"lotteryImg\">\n        <image\n          class=\"almost-lottery__bg\"\n          mode=\"widthFix\"\n          :src=\"lotteryBg\"\n          :style=\"{\n            width: lotteryPxSize + 'px',\n            height: lotteryPxSize + 'px'\n          }\"\n        ></image>\n        <image\n          class=\"almost-lottery__canvas-img\"\n          mode=\"widthFix\"\n\t\t  @tap=\"handleClickBg\"\n          :src=\"lotteryImg\"\n          :style=\"{\n            width: canvasImgPxSize + 'px',\n            height: canvasImgPxSize  + 'px',\n            left: canvasImgToLeftPx + 'px',\n            top: canvasImgToLeftPx + 'px',\n            transform: `rotate(${canvasAngle + targetAngle}deg)`,\n            transitionDuration: `${transitionDuration}s`\n          }\"\n        ></image>\n        <image\n          class=\"almost-lottery__action-bg\"\n          mode=\"widthFix\"\n          :src=\"actionBg\"\n          :style=\"{\n            width: actionPxSize + 'px',\n            height: actionPxSize + 'px',\n            left: actionBgToLeftPx + 'px',\n            top: actionBgToLeftPx + 'px',\n            transform: `rotate(${actionAngle + targetActionAngle}deg)`,\n            transitionDuration: `${transitionDuration}s`\n          }\"\n          @click=\"handleActionStart\"\n        ></image>\n      </template>\r\n    </view>\r\n    \r\n    <!-- 为了兼容 app 端 ctx.measureText 所需的标签 -->\r\n    <text class=\"almost-lottery__measureText\" :style=\"{ fontSize: higtFontSize + 'px' }\">{{ measureText }}</text>\r\n    \r\n    <!-- #ifdef MP-ALIPAY -->\r\n    <canvas \r\n      :class=\"className\"\r\n      :id=\"canvasId\"\r\n      :width=\"higtCanvasSize\"\r\n      :height=\"higtCanvasSize\"\r\n      :style=\"{\r\n        width: higtCanvasSize + 'px',\r\n        height: higtCanvasSize + 'px'\r\n      }\"\r\n    />\r\n    <!-- #endif -->\r\n    <!-- #ifndef MP-ALIPAY -->\r\n    <canvas\r\n      :class=\"className\"\r\n      :canvas-id=\"canvasId\"\r\n      :width=\"higtCanvasSize\"\r\n      :height=\"higtCanvasSize\"\r\n      :style=\"{\r\n        width: higtCanvasSize + 'px',\r\n        height: higtCanvasSize + 'px'\r\n      }\"\r\n    />\r\n    <!-- #endif -->\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n  const systemInfo = uni.getSystemInfoSync()\r\n\timport { getStore, setStore, clearStore, clacTextLen, downloadFile, pathToBase64, base64ToPath } from './almost-utils.js'\r\n  export default {\r\n    name: 'AlmostLottery',\r\n    props: {\n      // 设计稿的像素比基准值\n      pixelRatio: {\r\n        type: Number,\r\n        default: 2\n      },\r\n      // canvas 标识\r\n      canvasId: {\r\n        type: String,\r\n        default: 'almostLottery'\r\n      },\r\n      // 抽奖转盘的整体尺寸\r\n      lotterySize: {\r\n        type: Number,\r\n        default: 680\r\n      },\r\n      // 抽奖按钮的尺寸\r\n      actionSize: {\r\n        type: Number,\r\n        default: 200\r\n      },\r\n\t  // canvas边缘距离转盘边缘的距离\r\n\t  canvasMarginOutside: {\r\n        type: Number,\r\n        default: 90\r\n      },\r\n      // 奖品列表\r\n      prizeList: {\r\n        type: Array,\r\n        required: true,\r\n        validator: (value) => {\r\n          return value.length > 1\r\n        }\r\n      },\r\n      // 中奖奖品在列表中的下标\r\n      prizeIndex: {\r\n        type: Number,\r\n        required: true\r\n      },\r\n      // 奖品区块对应背景颜色\r\n      colors: {\r\n        type: Array,\r\n        default: () => [\r\n          '#FFFFFF',\r\n          '#FFBF05'\r\n        ]\r\n      },\r\n      // 转盘外环背景图\r\n      lotteryBg: {\r\n        type: String,\r\n        default: 'https://cdn2.hquesoft.com/box/rotateLottery/outer.png'\r\n      },\r\n      // 抽奖按钮背景图\r\n      actionBg: {\r\n        type: String,\r\n        default: 'https://cdn2.hquesoft.com/box/rotateLottery/center-tag.png'\r\n      },\r\n      // 是否绘制奖品名称\r\n      prizeNameDrawed: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n      },\r\n      // 是否开启奖品区块描边\r\n      stroked: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n      // 描边颜色\r\n      strokeColor: {\r\n        type: String,\r\n        default: '#FFBF05'\r\n      },\r\n      // 旋转的类型\r\n      rotateType: {\r\n        type: String,\r\n        default: 'roulette'\r\n      },\r\n      // 旋转动画时间 单位s\r\n      duration: {\r\n        type: Number,\r\n        default: 8\r\n      },\r\n      // 旋转的圈数\r\n      ringCount: {\r\n        type: Number,\r\n        default: 8\r\n      },\r\n      // 指针位置\r\n      pointerPosition: {\r\n        type: String,\r\n        default: 'edge',\r\n        validator: (value) => {\r\n          return value === 'edge' || value === 'middle'\r\n        }\r\n      },\r\n      // 文字方向\r\n      strDirection: {\r\n        type: String,\r\n        default: 'horizontal',\r\n        validator: (value) => {\r\n          return value === 'horizontal' || value === 'vertical'\r\n        }\r\n      },\r\n      // 字体颜色\r\n      strFontColors: {\n        type: Array,\n        default: () => [\n          '#FFBF05',\n          '#FFFFFF',\n\t\t  // '#000000'\n        ]\r\n      },\r\n      // 文字的大小\r\n      strFontSize: {\r\n        type: Number,\r\n        default: 26\r\n      },\r\n      // 奖品文字距离边缘的距离\r\n      strMarginOutside: {\r\n        type: Number,\r\n        default: 0\r\n      },\r\n      // 奖品图片距离奖品文字的距离\r\n      imgMarginStr: {\r\n        type: Number,\r\n        default: 46\r\n      },\r\n      // 奖品文字多行情况下的行高\r\n      strLineHeight: {\r\n        type: Number,\r\n        default: 1.2\r\n      },\r\n      // 奖品文字总长度限制\r\n      strMaxLen: {\r\n        type: Number,\r\n        default: 12\r\n      },\r\n      // 奖品文字多行情况下第一行文字长度\r\n      strLineLen: {\r\n        type: Number,\r\n        default: 6\r\n      },\r\n      // 奖品图片的宽\r\n      imgWidth: {\r\n        type: Number,\r\n        default: 80\r\n      },\r\n      // 奖品图片的高\r\n      imgHeight: {\r\n        type: Number,\r\n        default: 80\r\n      },\r\n\t\t\t// 是否绘制奖品图片\r\n\t\t\timgDrawed: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\t// 转盘绘制成功的提示\r\n\t\t\tsuccessMsg: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '奖品准备就绪，快来参与抽奖吧'\r\n\t\t\t},\r\n\t\t\t// 转盘绘制失败的提示\r\n\t\t\tfailMsg: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '奖品仍在准备中，请稍后再来...'\r\n\t\t\t},\r\n\t\t\t// 是否开启画板的缓存\r\n\t\t\tcanvasCached: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t}\r\n    },\r\n    data() {\r\n      return {\r\n        // 画板className\r\n        className: 'almost-lottery__canvas',\n        // 抽奖转盘的整体px尺寸\n        lotteryPxSize: 0,\n        // 画板的px尺寸\n        canvasImgPxSize: 0,\n        // 抽奖按钮的px尺寸\n        actionPxSize: 0,\n        // 奖品文字距离转盘边缘的距离\n        strMarginPxOutside: 0,\n        // 奖品图片相对奖品文字的距离\n        imgMarginPxStr: 0,\n        // 奖品图片的宽、高\n        imgPxWidth: 0,\n        imgPxHeight: 0,\r\n        // 画板导出的图片\r\n        lotteryImg: '',\r\n        // 旋转到奖品目标需要的角度\r\n        targetAngle: 0,\r\n        targetActionAngle: 0,\r\n        // 旋转动画时间 单位 s\r\n        transitionDuration: 0,\r\n        // 是否正在旋转\r\n        isRotate: false,\r\n        // 当前停留在那个奖品的序号\r\n        stayIndex: 0,\r\n        // 当前中奖奖品的序号\r\n        targetIndex: 0,\r\n\t\t\t\t// 是否存在可用的缓存转盘图\r\n\t\t\t\tisCacheImg: false,\r\n\t\t\t\toldLotteryImg: '',\r\n        // 解决 app 不支持 measureText 的问题\r\n\t\t\t\t// app 已在 2.9.3 的版本中提供了对 measureText 的支持，将在后续版本逐渐稳定后移除相关兼容代码\r\n        measureText: ''\r\n      }\r\n    },\r\n    computed: {\r\n      // 高清尺寸\r\n      higtCanvasSize() {\r\n        return this.canvasImgPxSize * systemInfo.pixelRatio\r\n      },\r\n      // 高清字体\r\n      higtFontSize() {\r\n        return Math.round(this.strFontSize / this.pixelRatio) * systemInfo.pixelRatio\r\n      },\r\n      // 高清行高\r\n      higtHeightMultiple() {\r\n        return Math.round(this.strFontSize / this.pixelRatio) * this.strLineHeight * systemInfo.pixelRatio\r\n      },\n      canvasImgToLeftPx () {\n        return (this.lotteryPxSize - this.canvasImgPxSize) / 2\n      },\n      actionBgToLeftPx () {\n        return (this.lotteryPxSize - this.actionPxSize) / 2\n      },\r\n      // 根据奖品列表计算 canvas 旋转角度\r\n      canvasAngle() {\r\n        let result = 0\r\n        \r\n        let prizeCount = this.prizeList.length\r\n        let prizeClip = 360 / prizeCount\r\n        let diffNum = 90 / prizeClip\r\n        if (this.pointerPosition === 'edge' || this.rotateType === 'pointer') {\r\n          result = -(prizeClip * diffNum)\r\n        } else {\r\n          result = -(prizeClip * diffNum + prizeClip / 2)\r\n        }\r\n        return result\r\n      },\r\n      actionAngle() {\r\n        return 0\r\n      },\r\n      // 外圆的半径\r\n      outsideRadius() {\r\n        return this.higtCanvasSize / 2\r\n      },\r\n      // 内圆的半径\r\n      insideRadius() {\r\n        return 20 * systemInfo.pixelRatio\r\n      },\r\n      // 文字距离边缘的距离\r\n      textRadius() {\r\n        return this.strMarginPxOutside * systemInfo.pixelRatio || (this.higtFontSize / 2)\r\n      },\r\n      // 根据画板的宽度计算奖品文字与中心点的距离\r\n      textDistance() {\r\n        const textZeroY = Math.round(this.outsideRadius - (this.insideRadius / 2))\r\n        return textZeroY - this.textRadius\r\n      }\r\n    },\r\n    watch: {\r\n      // 监听获奖序号的变动\r\n      prizeIndex(newVal, oldVal) {\r\n        if (newVal > -1) {\r\n          this.targetIndex = newVal\r\n          this.onRotateStart()\r\n        } else {\r\n          console.info('旋转结束，prizeIndex 已重置')\r\n        }\r\n      }\r\n    },\r\n    methods: {\n\t  handleClickBg () {\n\t\t  this.$emit('click-bg')\n\t  },\r\n      // 开始旋转\r\n      onRotateStart() {\r\n        if (this.isRotate) return\r\n        this.isRotate = true\r\n        // 奖品总数\r\n        let prizeCount = this.prizeList.length\r\n        let baseAngle = 360 / prizeCount\r\n        let angles = 0\r\n        \r\n        if (this.rotateType === 'pointer') {\r\n          if (this.targetActionAngle === 0) {\r\n            // 第一次旋转\r\n            angles = (this.targetIndex - this.stayIndex) * baseAngle + baseAngle / 2 - this.actionAngle\r\n          } else {\r\n            // 后续旋转\r\n            // 后续继续旋转 就只需要计算停留的位置与目标位置的角度\r\n            angles = (this.targetIndex - this.stayIndex) * baseAngle\r\n          }\r\n          \r\n          // 更新目前序号\r\n          this.stayIndex = this.targetIndex\r\n          // 转 8 圈，圈数越多，转的越快\r\n          this.targetActionAngle += angles + 360 * this.ringCount\r\n          console.log('targetActionAngle', this.targetActionAngle)\r\n        } else {\r\n          if (this.targetAngle === 0) {\r\n            // 第一次旋转\r\n            // 因为第一个奖品是从0°开始的，即水平向右方向\r\n            // 第一次旋转角度 = 270度 - (停留的序号-目标序号) * 每个奖品区间角度 - 每个奖品区间角度的一半 - canvas自身旋转的度数\r\n            angles = (270 - (this.targetIndex - this.stayIndex) * baseAngle - baseAngle / 2) - this.canvasAngle\r\n          } else {\r\n            // 后续旋转\r\n            // 后续继续旋转 就只需要计算停留的位置与目标位置的角度\r\n            angles = -(this.targetIndex - this.stayIndex) * baseAngle\r\n          }\r\n          \r\n          // 更新目前序号\r\n          this.stayIndex = this.targetIndex\r\n          // 转 8 圈，圈数越多，转的越快\r\n          this.targetAngle += angles + 360 * this.ringCount\r\n        }\r\n\r\n        // 计算转盘结束的时间，预加一些延迟确保转盘停止后触发结束事件\r\n        let endTime = this.transitionDuration * 1000 + 100\r\n        let endTimer = setTimeout(() => {\r\n          clearTimeout(endTimer)\r\n          endTimer = null\r\n\r\n          this.isRotate = false\r\n          this.$emit('draw-end')\r\n        }, endTime)\r\n\r\n        let resetPrizeTimer = setTimeout(() => {\r\n          clearTimeout(resetPrizeTimer)\r\n          resetPrizeTimer = null\r\n\r\n          // 每次抽奖结束后都要重置父级组件的 prizeIndex\r\n          this.$emit('reset-index')\r\n        }, endTime + 50)\r\n      },\r\n      // 点击 开始抽奖 按钮\r\n      handleActionStart() {\r\n        if (!this.lotteryImg) return\r\n        if (this.isRotate) return\r\n        this.$emit('draw-start')\r\n      },\r\n      // 渲染转盘\r\n      async onCreateCanvas() {\r\n        // 获取 canvas 画布\r\n        const canvasId = this.canvasId\r\n        const ctx = uni.createCanvasContext(canvasId, this)\r\n\r\n        // canvas 的宽高\r\n        let canvasW = this.higtCanvasSize\r\n        let canvasH = this.higtCanvasSize\r\n\r\n        // 根据奖品个数计算 角度\r\n        let prizeCount = this.prizeList.length\r\n        let baseAngle = Math.PI * 2 / prizeCount\r\n\r\n        // 设置字体\r\n        ctx.setFontSize(this.higtFontSize)\r\n\r\n        // 注意，开始画的位置是从0°角的位置开始画的。也就是水平向右的方向。\r\n        // 画具体内容\r\n        for (let i = 0; i < prizeCount; i++) {\r\n\t\t\t\t\tlet prizeItem = this.prizeList[i]\r\n          // 当前角度\r\n          let angle = i * baseAngle\r\n\r\n          // 保存当前画布的状态\r\n          ctx.save()\r\n          \r\n          // x => 圆弧对应的圆心横坐标 x\r\n          // y => 圆弧对应的圆心横坐标 y\r\n          // radius => 圆弧的半径大小\r\n          // startAngle => 圆弧开始的角度，单位是弧度\r\n          // endAngle => 圆弧结束的角度，单位是弧度\r\n          // anticlockwise(可选) => 绘制方向，true 为逆时针，false 为顺时针\r\n          \r\n          ctx.beginPath()\r\n          // 外圆\r\n          ctx.arc(canvasW * 0.5, canvasH * 0.5, this.outsideRadius, angle, angle + baseAngle, false)\r\n          // 内圆\r\n          ctx.arc(canvasW * 0.5, canvasH * 0.5, this.insideRadius, angle + baseAngle, angle, true)\r\n          \r\n          // 每个奖品区块背景填充颜色\r\n          if (this.colors.length === 2) {\r\n            ctx.setFillStyle(this.colors[i % 2])\r\n          } else {\r\n            ctx.setFillStyle(this.colors[i])\r\n          }\r\n          // 填充颜色\r\n          ctx.fill()\n          \n          // 设置文字颜色\n          if (this.strFontColors.length === 1) {\n            ctx.setFillStyle(this.strFontColors[0])\n          } else if (this.strFontColors.length === 2) {\n            ctx.setFillStyle(this.strFontColors[i % 2])\n          } else {\n            ctx.setFillStyle(this.strFontColors[i])\n          }\r\n          \r\n          // 开启描边\r\n          if (this.stroked) {\r\n            // 设置描边颜色\r\n            ctx.setStrokeStyle(`${this.strokeColor}`)\r\n            // 描边\r\n            ctx.stroke()\r\n          }\r\n\r\n          // 开始绘制奖品内容\r\n          // 重新映射画布上的 (0,0) 位置\r\n          let translateX = canvasW * 0.5 + Math.cos(angle + baseAngle / 2) * this.textDistance\r\n          let translateY = canvasH * 0.5 + Math.sin(angle + baseAngle / 2) * this.textDistance\r\n          ctx.translate(translateX, translateY)\r\n\r\n          // 绘制奖品名称\r\n          let rewardName = this.strLimit(prizeItem.prizeName)\r\n          \r\n          // rotate方法旋转当前的绘图，因为文字是和当前扇形中心线垂直的\r\n          ctx.rotate(angle + (baseAngle / 2) + (Math.PI / 2))\r\n\r\n          // 设置文本位置并处理换行\r\n          if (this.strDirection === 'horizontal') {\r\n            // 是否需要换行\r\n            if (rewardName && this.prizeNameDrawed) {\r\n              let realLen = clacTextLen(rewardName).realLen\r\n              let isLineBreak = realLen > this.strLineLen\r\n              if (isLineBreak) {\r\n                // 获得多行文本数组\r\n                let firstText = ''\r\n                let lastText = ''\r\n                let firstCount = 0\r\n                for (let j = 0; j < rewardName.length; j++) {\r\n                  firstCount += clacTextLen(rewardName[j]).byteLen\r\n                  if (firstCount <= (this.strLineLen * 2)) {\r\n                    firstText += rewardName[j]\r\n                  } else {\r\n                    lastText += rewardName[j]\r\n                  }\r\n                }\r\n                rewardName = firstText + ',' + lastText\r\n                let rewardNames = rewardName.split(',')\r\n                // 循环文本数组，计算每一行的文本宽度\r\n                for (let j = 0; j < rewardNames.length; j++) {\r\n                  if (ctx.measureText && ctx.measureText(rewardNames[j]).width > 0) {\r\n                    // 文本的宽度信息\r\n                    let tempStrSize = ctx.measureText(rewardNames[j])\r\n                    let tempStrWidth = -(tempStrSize.width / 2).toFixed(2)\r\n                    ctx.fillText(rewardNames[j], tempStrWidth, j * this.higtHeightMultiple)\r\n                  } else {\r\n                    this.measureText = rewardNames[j]\r\n                    \r\n                    // 等待页面重新渲染\r\n                    await this.$nextTick()\r\n                    \r\n                    let textWidth = await this.getTextWidth()\r\n                    let tempStrWidth = -(textWidth / 2).toFixed(2)\r\n                    ctx.fillText(rewardNames[j], tempStrWidth, j * this.higtHeightMultiple)\r\n                    // console.log(rewardNames[j], textWidth, j)\r\n                  }\r\n                }\r\n              } else {\r\n                if (ctx.measureText && ctx.measureText(rewardName).width > 0) {\r\n                  // 文本的宽度信息\r\n                  let tempStrSize = ctx.measureText(rewardName)\r\n                  let tempStrWidth = -(tempStrSize.width / 2).toFixed(2)\r\n                  ctx.fillText(rewardName, tempStrWidth, 0)\r\n                } else {\r\n                  this.measureText = rewardName\r\n                  \r\n                  // 等待页面重新渲染\r\n                  await this.$nextTick()\r\n                  \r\n                  let textWidth = await this.getTextWidth()\r\n                  let tempStrWidth = -(textWidth / 2).toFixed(2)\r\n                  ctx.fillText(rewardName, tempStrWidth, 0)\r\n                }\r\n              }\r\n            }\r\n          } else {\r\n            let rewardNames = rewardName.split('')\r\n            for (let j = 0; j < rewardNames.length; j++) {\r\n              if (ctx.measureText && ctx.measureText(rewardNames[j]).width > 0) {\r\n                // 文本的宽度信息\r\n                let tempStrSize = ctx.measureText(rewardNames[j])\r\n                let tempStrWidth = -(tempStrSize.width / 2).toFixed(2)\r\n                ctx.fillText(rewardNames[j], tempStrWidth, j * this.higtHeightMultiple)\r\n              } else {\r\n                this.measureText = rewardNames[j]\r\n                \r\n                // 等待页面重新渲染\r\n                await this.$nextTick()\r\n                \r\n                let textWidth = await this.getTextWidth()\r\n                let tempStrWidth = -(textWidth / 2).toFixed(2)\r\n                ctx.fillText(rewardNames[j], tempStrWidth, j * this.higtHeightMultiple)\r\n                // console.log(rewardNames[j], textWidth, i)\r\n              }\r\n            }\r\n          }\r\n          \r\n\r\n          // 绘制奖品图片，文字竖向展示时，不支持图片展示\r\n          if (this.imgDrawed && prizeItem.prizeImage && this.strDirection !== 'vertical') {\r\n\t\t\t\t\t\t// App-Android平台 系统 webview 更新到 Chrome84+ 后 canvas 组件绘制本地图像 uni.canvasToTempFilePath 会报错\r\n\t\t\t\t\t\t// 统一将图片处理成 base64\r\n\t\t\t\t\t\t// https://ask.dcloud.net.cn/question/103303\r\n\t\t\t\t\t\tlet reg = /^(https|http)/g\r\n\t\t\t\t\t\t// 处理远程图片\r\n\t\t\t\t\t\tif (reg.test(prizeItem.prizeImage)) {\r\n              let platformTips = ''\r\n              // #ifdef APP-PLUS\r\n\t\t\t\t\t\t\tplatformTips = ''\r\n              // #endif\r\n              // #ifdef MP\r\n\t\t\t\t\t\t\tplatformTips = '需要处理好下载域名的白名单问题，'\r\n              // #endif\r\n              // #ifdef H5\r\n\t\t\t\t\t\t\tplatformTips = '需要处理好跨域问题，'\r\n              // #endif\r\n\t\t\t\t\t\t\tconsole.warn(`###当前数据列表中的奖品图片为网络图片，${platformTips}开始尝试下载图片...###`)\r\n\t\t\t\t\t\t\tlet res = await downloadFile(prizeItem.prizeImage)\r\n\t\t\t\t\t\t\tconsole.log('处理远程图片', res)\r\n\t\t\t\t\t\t\tif (res.ok) {\r\n\t\t\t\t\t\t\t\tlet tempFilePath = res.tempFilePath\r\n\t\t\t\t\t\t\t\t// #ifndef MP\r\n\t\t\t\t\t\t\t\tprizeItem.prizeImage = await pathToBase64(tempFilePath)\r\n\t\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t\t// #ifdef MP\r\n\t\t\t\t\t\t\t\tprizeItem.prizeImage = tempFilePath\r\n\t\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t} else {\r\n                this.handlePrizeImgSuc({\r\n                  ok: false,\r\n                  data: res.data,\r\n                  msg: res.msg\r\n                })\r\n              }\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// #ifndef MP\n              // 不是小程序环境，把本地图片处理成 base64\r\n              if (prizeItem.prizeImage.indexOf(';base64,') === -1) {\r\n                console.log('开始处理本地图片', prizeItem.prizeImage)\r\n                prizeItem.prizeImage = await pathToBase64(prizeItem.prizeImage)\r\n                console.log('处理本地图片结束', prizeItem.prizeImage)\r\n              }\r\n\t\t\t\t\t\t\t// #endif\n              \n              // #ifdef MP-WEIXIN\n              // 小程序环境，把 base64 处理成小程序的本地临时路径\n              if (prizeItem.prizeImage.indexOf(';base64,') !== -1) {\r\n                console.log('开始处理BASE64图片', prizeItem.prizeImage)\n                prizeItem.prizeImage = await base64ToPath(prizeItem.prizeImage)\r\n                console.log('处理BASE64图片完成', prizeItem.prizeImage)\n              }\n              // #endif\r\n\t\t\t\t\t\t}\r\n            \r\n            let prizeImageX = -(this.imgPxWidth * systemInfo.pixelRatio / 2)\r\n            let prizeImageY = this.imgMarginPxStr * systemInfo.pixelRatio\r\n            let prizeImageW = this.imgPxWidth * systemInfo.pixelRatio\r\n            let prizeImageH = this.imgPxHeight * systemInfo.pixelRatio\r\n            ctx.drawImage(prizeItem.prizeImage, prizeImageX, prizeImageY, prizeImageW, prizeImageH)\r\n          }\r\n\r\n          ctx.restore()\r\n        }\r\n\r\n        // 保存绘图并导出图片\r\n        ctx.draw(true, () => {\r\n          let drawTimer = setTimeout(() => {\r\n            clearTimeout(drawTimer)\r\n            drawTimer = null\r\n\r\n            // #ifdef MP-ALIPAY\r\n            ctx.toTempFilePath({\r\n              destWidth: this.higtCanvasSize,\r\n              destHeight: this.higtCanvasSize,\r\n              success: (res) => {\r\n                // console.log(res.apFilePath)\r\n                this.handlePrizeImg({\r\n\t\t\t\t\t\t\t\t\tok: true,\r\n\t\t\t\t\t\t\t\t\tdata: res.apFilePath,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片成功'\r\n\t\t\t\t\t\t\t\t})\r\n              },\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n                this.handlePrizeImg({\r\n\t\t\t\t\t\t\t\t\tok: false,\r\n\t\t\t\t\t\t\t\t\tdata: err,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片失败'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n            })\r\n            // #endif\r\n            \r\n            // #ifndef MP-ALIPAY\r\n            uni.canvasToTempFilePath({\r\n              canvasId: this.canvasId,\r\n              success: (res) => {\r\n                // 在 H5 平台下，tempFilePath 为 base64\r\n                // console.log(res.tempFilePath)\r\n                this.handlePrizeImg({\r\n\t\t\t\t\t\t\t\t\tok: true,\r\n\t\t\t\t\t\t\t\t\tdata: res.tempFilePath,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片成功'\r\n\t\t\t\t\t\t\t\t})\r\n              },\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n                this.handlePrizeImg({\r\n\t\t\t\t\t\t\t\t\tok: false,\r\n\t\t\t\t\t\t\t\t\tdata: err,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片失败'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n            }, this)\r\n            // #endif\r\n          }, 500)\r\n        })\r\n      },\r\n      // 处理导出的图片\r\n      handlePrizeImg(res) {\r\n\t\t\t\tif (res.ok) {\r\n\t\t\t\t\tlet data = res.data\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!this.canvasCached) {\r\n\t\t\t\t\t\tthis.lotteryImg = data\r\n\t\t\t\t\t\tthis.handlePrizeImgSuc(res)\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// #ifndef H5\r\n\t\t\t\t\tif (this.isCacheImg) {\r\n\t\t\t\t\t\tuni.getSavedFileList({\r\n\t\t\t\t\t\t\tsuccess: (sucRes) => {\r\n\t\t\t\t\t\t\t\tlet fileList = sucRes.fileList\r\n\t\t\t\t\t\t\t\t// console.log('getSavedFileList Cached', fileList)\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlet cached = false\r\n                \r\n                if (fileList.length) {\r\n                  for (let i = 0; i < fileList.length; i++) {\r\n                  \tlet item = fileList[i]\r\n                  \tif (item.filePath === data) {\r\n                  \t\tcached = true\r\n                  \t\tthis.lotteryImg = data\r\n                  \t\t\r\n                  \t\tconsole.info('经查，本地缓存中存在的转盘图可用，本次将不再绘制转盘')\r\n                  \t\tthis.handlePrizeImgSuc(res)\r\n                  \t\tbreak\r\n                  \t}\r\n                  }\r\n                }\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (!cached) {\r\n\t\t\t\t\t\t\t\t\tconsole.info('经查，本地缓存中存在的转盘图不可用，需要重新初始化转盘绘制')\r\n\t\t\t\t\t\t\t\t\tthis.initCanvasDraw()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\tthis.initCanvasDraw()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.saveFile({\r\n\t\t\t\t\t\t\ttempFilePath: data,\r\n\t\t\t\t\t\t\tsuccess: (sucRes) => {\r\n\t\t\t\t\t\t\t\tlet filePath = sucRes.savedFilePath\r\n\t\t\t\t\t\t\t\t// console.log('saveFile', filePath)\r\n\t\t\t\t\t\t\t\tsetStore(`${this.canvasId}LotteryImg`, filePath)\r\n\t\t\t\t\t\t\t\tthis.lotteryImg = filePath\r\n\t\t\t\t\t\t\t\tthis.handlePrizeImgSuc({\r\n\t\t\t\t\t\t\t\t\tok: true,\r\n\t\t\t\t\t\t\t\t\tdata: filePath,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片成功'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\tthis.handlePrizeImg({\r\n\t\t\t\t\t\t\t\t\tok: false,\r\n\t\t\t\t\t\t\t\t\tdata: err,\r\n\t\t\t\t\t\t\t\t\tmsg: '画布导出生成图片失败'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\tsetStore(`${this.canvasId}LotteryImg`, data)\r\n\t\t\t\t\tthis.lotteryImg = data\r\n\t\t\t\t\tthis.handlePrizeImgSuc(res)\r\n          \r\n          // console info\r\n          let consoleText = this.isCacheImg ? '缓存' : '导出'\r\n          console.info(`当前为 H5 端，使用${consoleText}中的 base64 图`)\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error('处理导出的图片失败', res)\n          uni.showToast({\n            title: res.msg,\n          \tmask: true,\n          \ticon: 'none'\n          })\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\tconsole.error('###当前为 H5 端，下载网络图片需要后端配置允许跨域###')\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifdef MP\r\n\t\t\t\t\tconsole.error('###当前为小程序端，下载网络图片需要配置域名白名单###')\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t}\r\n      },\r\n\t\t\t// 处理图片完成\r\n\t\t\thandlePrizeImgSuc (res) {\r\n\t\t\t\tthis.$emit('finish', {\r\n\t\t\t\t\tok: res.ok,\r\n\t\t\t\t\tdata: res.data,\r\n\t\t\t\t\tmsg: res.ok ? this.successMsg : this.failMsg\r\n\t\t\t\t})\r\n\t\t\t},\r\n      // 兼容 app 端不支持 ctx.measureText\r\n      // 已知问题：初始绘制时，低端安卓机 平均耗时 2s\r\n      // hbx 2.8.12+ 已在 app 端支持\r\n      getTextWidth() {\r\n        console.warn('正在采用兼容方式获取文本的 size 信息，虽然没有任何问题，如果可以，请将此 systemInfo 及 hbx 版本号 反馈给作者', systemInfo)\r\n        let query = uni.createSelectorQuery().in(this)\r\n        let nodesRef = query.select('.almost-lottery__measureText')\r\n        return new Promise((resolve, reject) => {\r\n          nodesRef.fields({\r\n            size: true,\r\n          }, (res) => {\r\n            resolve(res.width)\r\n          }).exec()\r\n        })\r\n      },\r\n      // 处理文字溢出\r\n      strLimit(value) {\r\n        let maxLength = this.strMaxLen\r\n        if (!value || !maxLength) return value\r\n        return clacTextLen(value).realLen > maxLength ? value.slice(0, maxLength - 1) + '..' : value\r\n      },\r\n\t\t\t// 检查本地缓存中是否存在转盘图\r\n\t\t\tcheckCacheImg () {\r\n\t\t\t\tconsole.log('检查本地缓存中是否存在转盘图')\r\n\t\t\t\t// 检查是否已有缓存的转盘图\r\n\t\t\t\t// 检查是否与本次奖品数据相同\r\n\t\t\t\tthis.oldLotteryImg = getStore(`${this.canvasId}LotteryImg`)\r\n\t\t\t\tlet oldPrizeList = getStore(`${this.canvasId}PrizeList`)\r\n\t\t\t\tlet newPrizeList = JSON.stringify(this.prizeList)\r\n\t\t\t\tif (this.oldLotteryImg) {\r\n\t\t\t\t\tif (oldPrizeList === newPrizeList) {\r\n\t\t\t\t\t\tconsole.log(`经查，本地缓存中存在转盘图 => ${this.oldLotteryImg}`)\r\n\t\t\t\t\t\tthis.isCacheImg = true\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconsole.log('需要继续判断这张缓存图是否可用')\r\n\t\t\t\t\t\tthis.handlePrizeImg({\r\n\t\t\t\t\t\t\tok: true,\r\n\t\t\t\t\t\t\tdata: this.oldLotteryImg,\r\n\t\t\t\t\t\t\tmsg: '画布导出生成图片成功'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('经查，本地缓存中不存在转盘图')\r\n\t\t\t\tthis.initCanvasDraw()\r\n\t\t\t},\r\n      // 初始化绘制\r\n      initCanvasDraw () {\r\n\t\t\t\tconsole.log('开始初始化转盘绘制')\r\n\t\t\t\tthis.isCacheImg = false\r\n\t\t\t\tthis.lotteryImg = ''\r\n\t\t\t\tclearStore(`${this.canvasId}LotteryImg`)\r\n        setStore(`${this.canvasId}PrizeList`, this.prizeList)\r\n        this.onCreateCanvas()\r\n      },\n      // 预处理初始化\n      async beforeInit () {\n        let query = uni.createSelectorQuery().in(this)\n        // 处理 rpx 自适应尺寸\n        let lotterySize = await new Promise((resolve) => {\n          query.select('.almost-lottery__wrap').boundingClientRect((rects) => {\n            resolve(rects)\n            // console.log('处理 lottery rpx 的自适应', rects)\n          }).exec()\n        })\n        let actionSize = await new Promise((resolve) => {\n          query.select('.lottery-action').boundingClientRect((rects) => {\n            resolve(rects)\n            // console.log('处理 action rpx 的自适应', rects)\n          }).exec()\n        })\n        let strMarginSize = await new Promise((resolve) => {\n          query.select('.str-margin-outside').boundingClientRect((rects) => {\n            resolve(rects)\n            // console.log('处理 str-margin-outside rpx 的自适应', rects)\n          }).exec()\n        })\n        let imgMarginStr = await new Promise((resolve) => {\n          query.select('.img-margin-str').boundingClientRect((rects) => {\n            resolve(rects)\n            // console.log('处理 img-margin-str rpx 的自适应', rects)\n          }).exec()\n        })\n        let imgSize = await new Promise((resolve) => {\n          query.select('.img-size').boundingClientRect((rects) => {\n            resolve(rects)\n            // console.log('处理 img-size rpx 的自适应', rects)\n          }).exec()\n        })\n        \n        this.lotteryPxSize = Math.floor(lotterySize.width)\n        this.canvasImgPxSize = this.lotteryPxSize - Math.floor(actionSize.left) + Math.floor(lotterySize.left)\n        this.actionPxSize = Math.floor(actionSize.width)\n        \n        this.strMarginPxOutside = Math.floor(strMarginSize.left) - Math.floor(lotterySize.left)\n        this.imgMarginPxStr = Math.floor(imgMarginStr.left) - Math.floor(lotterySize.left)\n        this.imgPxWidth = Math.floor(imgSize.width)\n        this.imgPxHeight = Math.floor(imgSize.height)\n        \n        // console.log(this.lotteryPxSize, this.canvasImgPxSize, this.actionPxSize)\n        \n        let stoTimer = setTimeout(() => {\r\n          clearTimeout(stoTimer)\r\n          stoTimer = null\n          \n          // 判断画板是否设置缓存\n          if (this.canvasCached) {\n          \tthis.checkCacheImg()\n          } else {\n          \tthis.initCanvasDraw()\n          }\n          this.transitionDuration = this.duration\n        }, 50)\n      }\r\n    },\r\n    mounted() {\r\n      this.$nextTick(() => {\n        let delay = 50\n        \n        // 小程序平台需要更多的延时才能获取到准确的元素 Size 信息\n        // #ifdef MP\n        delay = 300\n        // #endif\n        \r\n        let stoTimer = setTimeout(() => {\r\n          clearTimeout(stoTimer)\r\n          stoTimer = null\n          \n          this.beforeInit()\r\n        }, delay)\r\n      })\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .almost-lottery {\r\n    display: flex;\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\n  \n  // 以下元素不可见，是 canvas 的实例\n  .almost-lottery__canvas {\n    position: absolute;\n    left: -9999px;\n    opacity: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n  \n  // 以下元素不可见，用于获得自适应的值\n  .lottery-action,\n  .str-margin-outside,\n  .img-margin-str,\n  .img-size {\n    position: absolute;\n    left: 0;\n    top: 0;\n    z-index: -1;\n    // background-color: blue;\n  }\r\n  \n  // 以下元素不可见，用于计算文本的宽度\r\n  .almost-lottery__measureText {\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    white-space: nowrap;\r\n    font-size: 12px;\r\n    opacity: 0;\r\n  }\r\n\r\n  // 以下为可见内容的样式\n  .almost-lottery__wrap {\r\n    position: relative;\r\n    // display: flex;\r\n    // justify-content: center;\r\n    // align-items: center;\n    // background-color: #FFFFFF;\n  }\n  \r\n  .almost-lottery__bg,\n  .almost-lottery__canvas-img,\r\n  .almost-lottery__action-bg {\r\n    position: absolute;\n    left: 0;\n    top: 0;\r\n  }\r\n\r\n  .almost-lottery__canvas-img {\r\n    transition: transform cubic-bezier(.34, .12, .05, .95);\r\n  }\r\n</style>\r\n","import mod from \"-!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./Lottery.vue?vue&type=style&index=0&id=d75a852c&lang=scss&scoped=true&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./Lottery.vue?vue&type=style&index=0&id=d75a852c&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1666352909534\n      var cssReload = require(\"E:/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}